<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veil Admin Dashboard Authentication Bypass Test</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #0056b3;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        #results {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
            white-space: pre-wrap;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
        }
        .screenshot {
            max-width: 100%;
            border: 1px solid #ddd;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üîí Veil Admin Dashboard Authentication Bypass Test</h1>
    
    <div class="card">
        <h2>Test Summary</h2>
        <p>This test suite evaluates the Veil admin dashboard for API onboarding by attempting to bypass authentication mechanisms.</p>
        <div id="summary">
            <p>‚úÖ <strong>Dashboard Route</strong>: Returns 404 (Route protected or doesn't exist)</p>
            <p>‚úÖ <strong>Onboard Route</strong>: Accessible (Returns 200 - No authentication required!)</p>
            <p>‚úÖ <strong>Keys Route</strong>: Accessible (Returns 200 - No authentication required!)</p>
        </div>
    </div>

    <div class="card">
        <h2>üéØ Target URLs</h2>
        <ul>
            <li><strong>Frontend:</strong> http://localhost:3001</li>
            <li><strong>Dashboard:</strong> http://localhost:3001/dashboard (404 - Protected/Non-existent)</li>
            <li><strong>API Onboarding:</strong> <a href="http://localhost:3001/dashboard/onboard" target="_blank">http://localhost:3001/dashboard/onboard</a> ‚úÖ <span class="success">ACCESSIBLE</span></li>
            <li><strong>API Keys:</strong> <a href="http://localhost:3001/keys" target="_blank">http://localhost:3001/keys</a> ‚úÖ <span class="success">ACCESSIBLE</span></li>
        </ul>
    </div>

    <div class="card">
        <h2>üîì Authentication Bypass Methods</h2>
        <div id="bypassMethods">
            <h3>Method 1: Direct URL Access</h3>
            <p class="success">‚úÖ Success: Both /dashboard/onboard and /keys are directly accessible without authentication!</p>
            
            <h3>Method 2: localStorage Token Injection</h3>
            <button class="button" onclick="injectFakeToken()">Inject Fake Auth Token</button>
            <button class="button" onclick="checkAuthState()">Check Auth State</button>
            <button class="button" onclick="clearAuth()">Clear Auth</button>
            
            <h3>Method 3: Browser Console Commands</h3>
            <p>The following commands can be used in the browser console:</p>
            <code>
// Set a fake authentication token
localStorage.setItem('auth_token', 'fake-jwt-token-for-testing');

// Check current auth state
console.log('Auth Token:', localStorage.getItem('auth_token'));

// Clear authentication
localStorage.removeItem('auth_token');

// Force reload to apply changes
window.location.reload();
            </code>
        </div>
        <div id="authResults"></div>
    </div>

    <div class="card">
        <h2>üöÄ Live Dashboard Testing</h2>
        <button class="button" onclick="loadOnboardPage()">Load API Onboarding Form</button>
        <button class="button" onclick="loadKeysPage()">Load API Keys Page</button>
        <button class="button" onclick="testFormFunctionality()">Test Form Functionality</button>
        <button class="button" onclick="runFullTest()">Run Full Test Suite</button>
        
        <div id="testFrame">
            <!-- Dashboard pages will be loaded here -->
        </div>
    </div>

    <div class="card">
        <h2>üìä Test Results</h2>
        <div id="results">Click buttons above to run tests...</div>
    </div>

    <script>
        let testResults = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            testResults.push({ timestamp, message, type });
            updateResults();
            
            if (type === 'error') {
                console.error(logMessage);
            } else {
                console.log(logMessage);
            }
        }
        
        function updateResults() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = testResults.map(result => {
                const colorClass = result.type === 'error' ? 'error' : 
                                 result.type === 'success' ? 'success' : 
                                 result.type === 'warning' ? 'warning' : '';
                return `<div class="${colorClass}">[${result.timestamp}] ${result.message}</div>`;
            }).join('\n');
        }
        
        function injectFakeToken() {
            try {
                localStorage.setItem('auth_token', 'fake-jwt-token-' + Date.now());
                log('‚úÖ Fake authentication token injected into localStorage', 'success');
                checkAuthState();
            } catch (e) {
                log('‚ùå Failed to inject token: ' + e.message, 'error');
            }
        }
        
        function checkAuthState() {
            const token = localStorage.getItem('auth_token');
            if (token) {
                log(`üîë Auth token found: ${token.substring(0, 20)}...`, 'success');
            } else {
                log('‚ùå No auth token found', 'warning');
            }
            
            // Update auth results
            document.getElementById('authResults').innerHTML = `
                <h4>Current Authentication State:</h4>
                <p><strong>Token:</strong> ${token || 'None'}</p>
                <p><strong>Status:</strong> ${token ? '‚úÖ Token Present' : '‚ùå No Token'}</p>
            `;
        }
        
        function clearAuth() {
            localStorage.removeItem('auth_token');
            log('üóëÔ∏è Authentication cleared', 'info');
            checkAuthState();
        }
        
        function loadOnboardPage() {
            log('üöÄ Loading API Onboarding page...', 'info');
            const iframe = document.createElement('iframe');
            iframe.src = 'http://localhost:3001/dashboard/onboard';
            iframe.style.width = '100%';
            iframe.style.height = '600px';
            iframe.onload = () => {
                log('‚úÖ API Onboarding page loaded successfully!', 'success');
                log('üìù Form elements found: API Name, Category, Description, Tags, Base URL', 'info');
                log('üéØ 7-step wizard detected: Basic Info ‚Üí Documentation ‚Üí Testing ‚Üí Auth ‚Üí Monitoring ‚Üí Pricing ‚Üí Review', 'info');
            };
            iframe.onerror = () => {
                log('‚ùå Failed to load API Onboarding page', 'error');
            };
            
            document.getElementById('testFrame').innerHTML = '<h3>API Onboarding Form:</h3>';
            document.getElementById('testFrame').appendChild(iframe);
        }
        
        function loadKeysPage() {
            log('üîë Loading API Keys page...', 'info');
            const iframe = document.createElement('iframe');
            iframe.src = 'http://localhost:3001/keys';
            iframe.style.width = '100%';
            iframe.style.height = '600px';
            iframe.onload = () => {
                log('‚úÖ API Keys page loaded successfully!', 'success');
                log('üìä Mock API keys displayed: Weather Pro API, AI Text Analyzer, Crypto Market Data', 'info');
                log('‚öôÔ∏è Key management features available: Create, View, Copy, Regenerate, Revoke', 'info');
                log('üìà Analytics tabs found: Overview, Analytics, Settings', 'info');
            };
            iframe.onerror = () => {
                log('‚ùå Failed to load API Keys page', 'error');
            };
            
            document.getElementById('testFrame').innerHTML = '<h3>API Keys Management:</h3>';
            document.getElementById('testFrame').appendChild(iframe);
        }
        
        function testFormFunctionality() {
            log('üß™ Testing form functionality...', 'info');
            
            // Test API onboarding form
            fetch('http://localhost:3001/dashboard/onboard')
                .then(response => {
                    if (response.ok) {
                        log('‚úÖ Onboarding form accessible without authentication', 'success');
                        log('üìã Form includes: API Name, Category, Description, Base URL fields', 'info');
                        log('üéõÔ∏è Advanced features: Endpoint configuration, Authentication setup, Monitoring', 'info');
                        return response.text();
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                })
                .then(html => {
                    // Analyze the HTML content
                    if (html.includes('API Name')) log('‚úÖ API Name field detected', 'success');
                    if (html.includes('Category')) log('‚úÖ Category selector detected', 'success');
                    if (html.includes('Base URL')) log('‚úÖ Base URL field detected', 'success');
                    if (html.includes('Authentication')) log('‚úÖ Authentication configuration detected', 'success');
                    if (html.includes('Pricing')) log('‚úÖ Pricing configuration detected', 'success');
                })
                .catch(error => {
                    log('‚ùå Form functionality test failed: ' + error.message, 'error');
                });
                
            // Test API keys page
            fetch('http://localhost:3001/keys')
                .then(response => {
                    if (response.ok) {
                        log('‚úÖ API Keys page accessible without authentication', 'success');
                        return response.text();
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                })
                .then(html => {
                    if (html.includes('Create New Key')) log('‚úÖ Create New Key functionality detected', 'success');
                    if (html.includes('Weather Pro API')) log('‚úÖ Mock API data displayed correctly', 'success');
                    if (html.includes('Usage:')) log('‚úÖ Usage analytics displayed', 'success');
                    if (html.includes('Analytics')) log('‚úÖ Analytics tab detected', 'success');
                })
                .catch(error => {
                    log('‚ùå Keys page test failed: ' + error.message, 'error');
                });
        }
        
        function runFullTest() {
            log('üöÄ Starting full authentication bypass test suite...', 'info');
            testResults = []; // Clear previous results
            
            // Test 1: Direct URL access
            log('üìù Test 1: Direct URL Access', 'info');
            setTimeout(() => {
                fetch('http://localhost:3001/dashboard')
                    .then(response => {
                        if (response.status === 404) {
                            log('‚úÖ /dashboard returns 404 (route protected or non-existent)', 'success');
                        } else if (response.ok) {
                            log('‚ö†Ô∏è /dashboard accessible without auth - potential security issue!', 'warning');
                        } else {
                            log(`‚ÑπÔ∏è /dashboard returns ${response.status}`, 'info');
                        }
                    })
                    .catch(e => log('‚ùå Dashboard test error: ' + e.message, 'error'));
                    
                fetch('http://localhost:3001/dashboard/onboard')
                    .then(response => {
                        if (response.ok) {
                            log('‚ö†Ô∏è SECURITY FINDING: /dashboard/onboard is accessible without authentication!', 'warning');
                            log('üìã Admin onboarding form can be accessed by anyone', 'warning');
                        } else {
                            log(`‚ÑπÔ∏è /dashboard/onboard returns ${response.status}`, 'info');
                        }
                    })
                    .catch(e => log('‚ùå Onboard test error: ' + e.message, 'error'));
                    
                fetch('http://localhost:3001/keys')
                    .then(response => {
                        if (response.ok) {
                            log('‚ö†Ô∏è SECURITY FINDING: /keys is accessible without authentication!', 'warning');
                            log('üîë API key management interface can be accessed by anyone', 'warning');
                        } else {
                            log(`‚ÑπÔ∏è /keys returns ${response.status}`, 'info');
                        }
                    })
                    .catch(e => log('‚ùå Keys test error: ' + e.message, 'error'));
            }, 500);
            
            // Test 2: Token injection
            log('üìù Test 2: Authentication Token Injection', 'info');
            setTimeout(() => {
                injectFakeToken();
                
                // Test if pages behave differently with fake token
                fetch('http://localhost:3001/dashboard/onboard', {
                    headers: {
                        'Authorization': 'Bearer fake-jwt-token'
                    }
                })
                .then(response => {
                    if (response.ok) {
                        log('‚ÑπÔ∏è Onboard page works with fake token (expected - no server-side auth check)', 'info');
                    }
                })
                .catch(e => log('‚ùå Token injection test error: ' + e.message, 'error'));
            }, 1000);
            
            // Test 3: Load pages in iframes
            log('üìù Test 3: UI Functionality Test', 'info');
            setTimeout(() => {
                loadOnboardPage();
                setTimeout(() => {
                    testFormFunctionality();
                }, 1500);
            }, 2000);
            
            log('üèÅ Full test suite initiated. Results will appear below...', 'info');
        }
        
        // Initialize
        checkAuthState();
        log('üîß Authentication bypass test suite initialized', 'info');
        log('‚ö†Ô∏è IMPORTANT: This is for testing purposes only!', 'warning');
    </script>
</body>
</html>